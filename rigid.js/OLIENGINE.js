MJS_VERSION=0;MJS_DO_ASSERT=true;if(typeof WebGLFloatArray==="undefined")WebGLFloatArray=Array;MJS_FLOAT_ARRAY_TYPE=WebGLFloatArray;new MJS_FLOAT_ARRAY_TYPE(3);new MJS_FLOAT_ARRAY_TYPE(3);new MJS_FLOAT_ARRAY_TYPE(3);if(MJS_FLOAT_ARRAY_TYPE==Array)var h=function(a,b,c){return[a,b,c]},i=function(a){return[a[0],a[1],a[2]]};else{new MJS_FLOAT_ARRAY_TYPE([1,0,0]);new MJS_FLOAT_ARRAY_TYPE([0,1,0]);new MJS_FLOAT_ARRAY_TYPE([0,0,1]);h=function(a,b,c){return new MJS_FLOAT_ARRAY_TYPE([a,b,c])};i=function(a){return new MJS_FLOAT_ARRAY_TYPE(a)}}
function j(a,b,c){if(c==undefined)c=new MJS_FLOAT_ARRAY_TYPE(3);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c}function k(a,b,c){if(c==undefined)c=new MJS_FLOAT_ARRAY_TYPE(3);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c}function n(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}function o(a,b){if(b==undefined)b=new MJS_FLOAT_ARRAY_TYPE(3);var c=1/n(a);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;return b}
function p(a,b,c){if(c==undefined)c=new MJS_FLOAT_ARRAY_TYPE(3);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c}function q(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}new MJS_FLOAT_ARRAY_TYPE(16);new MJS_FLOAT_ARRAY_TYPE(16);MJS_FLOAT_ARRAY_TYPE!=Array&&new MJS_FLOAT_ARRAY_TYPE([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function r(a){this.startTime=(new Date).getTime();this.da=this.T();this.ea=this.T();this.frames=0;this.R="...";this.Ha=a||60;this.ba=0}r.prototype={ya:function(){this.K=this.T();this.Aa=this.K-this.da;this.Ea=this.K-this.ea;if(this.Ea>=1E3){this.R=this.frames.toString();this.frames=0;this.ea=this.K}else this.frames++;this.da=this.K;this.ba=this.R/this.Ha;return this.R+" FPS / "+this.Aa+" MS, Deviance: "+this.ba+"%"},T:function(){return(new Date).getTime()-this.startTime}};function s(a,b){function c(){}c.prototype=b.prototype;a.Ka=b.prototype;a.prototype=new c};function t(a,b,c){this.a=this.l=a;this.F=h(0,0,0);this.t=b;this.sa(c)}
t.prototype={H:function(){return this.I==0},r:function(a){if(this.H()&&a.H())return false;var b=k(this.a,a.a),c=this.t+a.t,d=q(b,b);if(d>c*c)return false;d=Math.sqrt(d);b[0]/=d;b[1]/=d;b[2]/=d;return this.la(a,b,c-d)},V:function(a){this.H()||j(this.F,p(a,this.m),this.F)},sa:function(a){if(a<1.0E-5)this.m=this.I=0;else{this.I=a;this.m=1/this.I}},o:function(a,b){a.fillStyle="rgba("+Math.round(b[0]*255)+","+Math.round(b[1]*255)+","+Math.round(b[2]*255)+","+b[3]+")";a.beginPath();a.arc(this.l[0],this.l[1],
this.t,0,Math.PI*2,false);a.fill();a.fillStyle="rgba("+Math.round(b[0]*255)+","+Math.round(b[1]*255)+","+Math.round(b[2]*255)+","+b[3]+")";a.beginPath();a.arc(this.l[0],this.l[1],2,0,Math.PI*2,false);a.fill()},w:function(a){if(this.H()){this.F=h(0,0,0);this.l=i(this.a)}else{var b=i(this.a);j(j(k(this.a,this.l),p(this.F,a*a)),this.a,this.a);this.l=b;this.F=h(0,0,0)}},X:function(a,b){var c=h(this.t,this.t,this.t);k(this.a,c,a);j(this.a,c,b)},$:function(a,b){j(this.a,p(a,b),this.a);var c=k(this.a,this.l),
d=p(a,q(c,a));c=k(c,d);k(this.a,p(c,0.5),this.a);return true},la:function(a,b,c){var d=this.m+a.m;k(a.a,p(b,c*a.m),a.a);j(this.a,p(b,c*this.m),this.a);c=k(this.a,this.l);var e=k(a.a,a.l);c=k(c,e);b=p(b,q(c,b));b=k(c,b);b[0]/=d;b[1]/=d;b[2]/=d;k(this.a,p(b,0.5*this.m),this.a);j(a.a,p(b,0.5*a.m),a.a);return true}};function u(a){this.h=[];this.J=[];this.D=this.g=0;this.Ca=this.Da=100;this.U=typeof a==="undefined"?this.U=1:a;this.q=0;this.k=h(0,0,0);this.p=[];this.p[0]=0;this.p[1]=1;this.p[2]=0;this.p[3]=0.5}
u.prototype={O:function(a){a.strokeStyle="rgba(204,204,204,0.3)";a.beginPath();a.arc(this.k[0],this.k[1],this.q,0,Math.PI*2,false);a.stroke()},o:function(a){this.O(a);for(var b=0;b<this.g;b++)this.h[b].o(a,this.p);for(b=0;b<this.D;b++)this.J[b].o(a)},ga:function(a){for(var b=0;b<this.g;b++)if(a){var c=k(a,this.h[b].l);c[0]/=0.5;c[1]/=0.5;c[2]/=0.5;this.h[b].V(c)}else this.h[b].V(p(h(0,100,0),this.h[b].I))},xa:function(a){for(var b=0;b<this.g;b++)this.h[b].w(a)},L:function(a){var b=k(this.k,a.k);a=
this.q+a.q;a=a*a;return q(b,b)<a},Z:function(){return false},r:function(a){if(!this.L(a))return false;for(var b=false,c=0;c<this.g;c++)for(var d=0;d<a.g;d++)if(this.h[c].r(a.h[d]))b=true;return b},wa:function(){for(var a=0;a<this.U;a++)for(var b=0;b<this.D;b++)this.J[b].w()},va:function(){this.C()},z:function(a){this.g>=this.Da||(this.h[this.g++]=a)},G:function(a){this.D>=this.Ca||this.pa(a)||(this.J[this.D++]=a)},pa:function(a){for(var b=0;b<this.D;b++)if(this.J[b]==a)return true;return false},i:function(a){return this.h[a]},
Q:function(a){this.U=a<1?1:a},C:function(){if(!(this.g<=0)){var a={},b={};this.h[0].X(a,b);for(var c=1;c<this.g;c++){var d={},e={};this.h[c].X(d,e);if(d[0]<a[0])a[0]=d[0];if(d[1]<a[1])a[1]=d[1];if(d[2]<a[2])a[2]=d[2];if(e[0]>b[0])b[0]=e[0];if(e[1]>b[1])b[1]=e[1];if(e[2]>b[2])b[2]=e[2]}p(j(b,a),0.5,this.k);this.q=n(p(k(b,a),0.5))}},P:function(a,b,c,d){this.p[0]=a;this.p[1]=b;this.p[2]=c;this.p[3]=d}};function v(a,b){this.A=a;this.B=b;this.Ba=n(k(a.a,b.a))}v.prototype={w:function(){if(this.A&&this.B){var a=this.Ba,b=a*a;a=this.A.m;var c=this.B.m,d=a+c;if(!(d<1.0E-5)){var e=this.A.a,f=this.B.a,g=k(f,e);b=b/(q(g,g)+b)-0.5;b*=-2;p(g,b/d,g);j(e,p(g,a),e);k(f,p(g,c),f)}}},o:function(a){if(this.A&&this.B){a.strokeStyle="#999999";a.beginPath();a.moveTo(this.A.a[0],this.A.a[1]);a.lineTo(this.B.a[0],this.B.a[1]);a.stroke()}}};function w(){u.call(this)}s(w,u);function x(a,b,c,d){u.call(this);this.P(1,0.3,0.3,0.5);this.Q(d);d=b*Math.sqrt(2)/2;b=b/2;a=[j(h(-b,-b,0),a),j(h(b,-b,0),a),j(h(b,b,0),a),j(h(-b,b,0),a)];this.z(new t(a[0],d,c));this.z(new t(a[1],d,c));this.z(new t(a[2],d,c));this.z(new t(a[3],d,c));for(c=0;c<this.g;c++)for(a=c+1;a<this.g;a++)this.G(new v(this.i(c),this.i(a)));this.C()}s(x,w);function y(a,b,c,d,e){u.call(this);this.P(0.6,0.6,1,0.5);c=c;if(c<4)c=4;c+=c%2==0?0:1;this.Q(e);var f=Math.sqrt(2)*0.75*b*(4/c);for(e=0;e<c;e++){var g=Math.PI*2*(e/c),l=b*0.2;if(l==undefined)l=1;l=Math.random()*l+b*0.8;g=j(a,p(h(Math.cos(g),Math.sin(g),0),l));this.z(new t(g,f,d))}for(e=0;e<c;e++){a=(e+1)%c;this.G(new v(this.i(e),this.i(a)))}for(e=0;e<c/2;e++){a=(e+c/2)%c;this.G(new v(this.i(e),this.i(a)))}}s(y,u);function z(a,b,c,d,e,f){u.call(this,d);this.ca=0;this.P(0,1,0.3,0.5);d=d;if(!(c<2)){if(d<=0)d=1;this.Q(d);d=i(a);a=k(a,b);a[0]/=c;a[1]/=c;a[2]/=c;for(b=0;b<c;b++){this.z(new t(d,e,b!=0?f:0));d=j(d,a)}for(b=0;b<c-1;b++){this.G(new v(this.i(b),this.i(b+1)));d=j(d,a)}this.C();this.ca=2}}s(z,u);z.prototype.Z=function(){for(var a=false,b=0;b<this.g;b++)for(var c=b+this.ca;c<this.g;c++)a|=this.i(b).r(this.i(c));return a};function A(a,b){this.f=a;this.v=b==undefined?h(0,0,0):b}
A.prototype={r:function(a){var b=k(a.a,this.f),c=q(b,b),d=a.t;if(c>d*d)return false;var e=a.a,f=a.t,g=this.f,l=this.v,m=void 0;if(m==undefined)m=new MJS_FLOAT_ARRAY_TYPE(3);m[0]=-l[0];m[1]=-l[1];m[2]=-l[2];l=m;m=k(g,e);e=q(l,l);g=q(m,l)*2;f=g*g-4*e*(q(m,m)-f*f);if(f<0)g=false;else{f=Math.sqrt(f);if(e==0)g=false;else{e=1/(2*e);t0=(-g-f)*e;t1=(-g+f)*e;if(t1<t0){f=t0;t0=t1;t1=f}g={Fa:t0,Ga:t1}}}f=g.Fa;e=g.Ga;if(g)if(f>1E3||e<0)f=false;else{g=f;if(f<0)g=e;f=g}else f=false;if(f)return a.$(this.v,f);else{c=
Math.sqrt(c);b[0]/=c;b[1]/=c;b[2]/=c;return a.$(b,d-c)}}};function B(){this.d=[];this.q=this.u=0;this.k=h(0,0,0)}
B.prototype={ta:function(a,b,c){this.u=b;for(var d=0;d<b;d++){var e=d;if(c)e=b-1-d;this.d[e]=new A(a[d])}for(d=0;d<b;d++){e=d-1;a=d+1;if(e<0)e+=b;if(a>=b)a-=b;e=k(this.d[a].f,this.d[e].f);e=h(-e[1],e[0],0);o(e,e);j(this.d[d].v,e,this.d[d].v)}for(d=0;d<this.u;d++)o(this.d[d].v,this.d[d].v);this.C()},ia:function(a){if(!this.L(a))return false;for(var b=false,c=0;c<a.g;c++)b|=this.ka(a.i(c));return b},ka:function(a){for(var b=false,c=this.u-1,d=0;d<this.u;c=d,d++)b|=this.ja(a,this.d[c],this.d[d]);return b},
ja:function(a,b,c){var d=k(c.f,b.f),e=k(a.a,b.f);e=q(e,d);if(e<0)return b.r(a);var f=q(d,d);if(e>f)return c.r(a);e=e/f;f=1-e;d=j(b.f,p(d,e));b=j(p(b.v,f),p(c.v,e));o(b,b);return(new A(d,b)).r(a)},C:function(){if(this.u!=0){for(var a=i(this.d[0].f),b=i(a),c=1;c<this.u;c++){var d=i(this.d[c].f);if(d[0]<a[0])a[0]=d[0];if(d[1]<a[1])a[1]=d[1];if(d[2]<a[2])a[2]=d[2];if(d[0]>b[0])b[0]=d[0];if(d[1]>b[1])b[1]=d[1];if(d[2]>b[2])b[2]=d[2]}p(j(b,a),0.5,this.k);this.q=n(p(k(b,a),0.5))}},L:function(a){var b=k(this.k,
a.k);a=this.q+a.q;a=a*a;return q(b,b)<a},o:function(a){a.strokeStyle="rgba(179, 179, 179, 1.0)";a.lineWidth=2;a.beginPath();a.moveTo(this.d[0].f[0],this.d[0].f[1]);var b=0,c=this.u-1;for(b=0;b<this.u;b++){a.lineTo(this.d[b].f[0],this.d[b].f[1]);b==c&&a.lineTo(this.d[0].f[0],this.d[0].f[1])}a.stroke();a.lineWidth=1;this.O(a)},O:function(a){a.strokeStyle="rgba(0,255,0,0.3)";a.beginPath();a.arc(this.k[0],this.k[1],this.q,0,Math.PI*2,false);a.stroke()}};function C(a,b,c,d,e){B.call(this);if(e==undefined)e=false;b=b;c=c;e=e;if(e==undefined)e=false;if(c<4)c=4;var f=[];b*=1;for(var g=0;g<c;g++){var l=-Math.PI*2*(g/c),m=Math.random()*b*d+b*(1-d);f[g]=j(a,p(h(Math.cos(l),Math.sin(l),0),m))}this.ta(f,c,e)}s(C,B);function D(){this.c=[];this.e=0;this.j=[];this.n=0}
D.prototype={ma:function(){for(;this.e>0;)this.na(this.c[0]);for(;this.n>0;)this.oa(this.j[0])},na:function(a){if(a!=undefined)for(var b=0;b<this.e;b++)if(this.c[b]==a){this.c[b]=undefined;this.e--;this.c[b]=this.c[this.e];this.c[this.e]=undefined;return}},N:function(a){if(!(this.e>=E)){this.c[this.e]=a;this.e++}},oa:function(a){if(a!=undefined)for(var b=0;b<this.n;b++)if(this.j[b]==a){this.j[b]=undefined;this.n--;this.j[b]=this.j[this.n];this.j[this.n]=undefined;return}},Y:function(a){if(!(this.n>=
F)){this.j[this.n]=a;this.n++}},w:function(a,b){for(var c=0;c<this.e;c++)this.c[c]&&this.c[c].ga(b);for(c=0;c<this.e;c++)this.c[c]&&this.c[c].xa(a);for(c=0;c<this.e;c++)if(this.c[c]!=undefined){this.c[c].Z();for(var d=c+1;d<this.e;d++)this.c[d]!=undefined&&this.c[c].r(this.c[d])}for(c=0;c<this.e;c++)if(this.c[c]!=undefined)for(d=0;d<this.n;d++)this.j[d]!=undefined&&this.j[d].ia(this.c[c]);for(c=0;c<this.e;c++)this.c[c]&&this.c[c].wa();for(c=0;c<this.e;c++)this.c[c]&&this.c[c].va()},o:function(a){for(var b=
0;b<this.e;b++)this.c[b]&&this.c[b].o(a);for(b=0;b<this.n;b++)this.j[b]&&this.j[b].o(a)}};var F=256,E=256;function G(a){this.b=a;this.s=new D}
G.prototype={ha:function(){this.w(1/30);this.aa.clearRect(0,0,this.fa[0],this.fa[1]);this.s.o(this.aa);this.S.innerHTML=this.za.ya()},w:function(a){this.s.w(a,false)},ra:function(a,b,c){this.fa=h(a,b,0);this.Ia=c;this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",a);this.canvas.setAttribute("height",b);this.aa=this.canvas.getContext("2d");document.getElementsByTagName("body")[0].appendChild(this.canvas);this.za=new r(c);this.S=document.createElement("div");this.S.id="fpsMeter";
document.getElementsByTagName("body")[0].appendChild(this.S);this.M()},M:function(){this.s.ma();this.s.Y(new C(h(this.b[0]/2,this.b[1]/2,0),Math.min(this.b[0],this.b[1])*0.5,24,0.2,true));for(var a=0;a<5;a++){var b=h(Math.random()*Math.min(this.b[0],this.b[1]),Math.random()*Math.min(this.b[0],this.b[1]),0),c=Math.random()*Math.min(this.b[0],this.b[1])/30+Math.min(this.b[0],this.b[1])/20,d=10,e=Math.floor(Math.random()*32767)&3,f=Math.random()*3+1;this.s.N(new y(b,c,d,f,e))}for(a=0;a<4;a++){b=h(Math.random()*
Math.min(this.b[0],this.b[1]),Math.random()*Math.min(this.b[0],this.b[1]),0);d=Math.random()*(Math.min(this.b[0],this.b[1])/30)+Math.min(this.b[0],this.b[1])/40;f=Math.random()*3+1.5;e=Math.floor(Math.random()*32767)&2;this.s.N(new x(b,d,f,e))}for(a=0;a<3;a++){b=h(Math.random()*Math.min(this.b[0],this.b[1]),Math.random()*Math.min(this.b[0],this.b[1]),0);f=Math.random()*(Math.min(this.b[0],this.b[1])/10)+Math.min(this.b[0],this.b[1])/6;e=Math.random()*Math.PI*2;c=j(b,p(h(Math.cos(e),Math.sin(e),0),
f));d=8;e=Math.floor(Math.random()*32767)&2;var g=0.75*f/d;f=Math.random()*3+1;this.s.N(new z(b,c,d,e,g,f))}for(a=0;a<6;a++){e=h(Math.random()*Math.min(this.b[0],this.b[1])*1.2,Math.random()*this.Ja*1.2,0);g=Math.random()*Math.min(this.b[0],this.b[1])*0.1+Math.min(this.b[0],this.b[1])*0.05;this.s.Y(new C(e,g,8,0.4,false))}var l=this;window.addEventListener("keydown",function(m){l.W(m)},false)},W:function(a){a.keyCode==27&&clearInterval(this.qa);a.keyCode==32&&this.M()},ua:function(){var a=this;this.qa=
setInterval(function(){a.ha()},1E3/this.Ia)}};window.CWorld=G;G.prototype.InitBasicRenderer=G.prototype.ra;G.prototype.StartBasicRun=G.prototype.ua;G.prototype.BasicKeyHandler=G.prototype.W;G.prototype.InitBasicScene=G.prototype.M;
